<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hong Kong Geospatial Deep Learning Datasets</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Discover Hong Kong geospatial deep learning datasets including object detection and semantic segmentation data for urban research and analysis." />
  <meta name="keywords" content="Hong Kong, geospatial, deep learning, object detection, semantic segmentation, datasets" />
  <link rel="canonical" href="https://22003109.github.io/hkgeodld" />
  
  <!-- Open Graph Tags -->
  <meta property="og:title" content="Hong Kong Geospatial Deep Learning Datasets" />
  <meta property="og:description" content="Explore and use geospatial deep learning datasets for Hong Kong urban analysis. Download object detection and segmentation datasets in YOLO format." />
  <meta property="og:image" content="https://22003109.github.io/hkgeodld/images/hero.webp" />
  <meta property="og:url" content="https://22003109.github.io/hkgeodld" />
  <meta property="og:type" content="website" />
  
  <!-- Twitter Card Tags -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Hong Kong Geospatial Deep Learning Datasets" />
  <meta name="twitter:description" content="Discover geospatial deep learning datasets for Hong Kong including annotations for object detection and semantic segmentation." />
  <meta name="twitter:image" content="https://22003109.github.io/hkgeodld/images/hero.webp" />

  <!-- Bootstrap 5.3.6 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome 6.7.2 for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
  <!-- PhotoSwipe CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe.css" />
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üó∫Ô∏è</text></svg>" />
  <!-- Custom CSS -->
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #0ea5e9;
      --accent: #f97316;
      --light: #f8fafc;
      --dark: #0f172a;
      --text-light: #e2e8f0;
      --text-dark: #1e293b;
      --text-muted: #94a3b8;
      --background: #f1f5f9;
    }

    body {
      padding-top: 56px; /* Height of navbar */
      background-color: var(--background);
      color: var(--text-dark);
    }

    .navbar {
      background-color: var(--dark) !important;
    }

    .navbar-brand, .nav-link {
      color: var(--text-light) !important;
    }

    .nav-link.active {
      color: var(--accent) !important;
      font-weight: 500;
    }

    /* Add pointer cursor to navigation items */
    .nav-link, .nav-link-custom, #view-datasets-btn, #exploreDatasets {
      cursor: pointer;
    }

    .hero-section {
      height: 400px;
      background-image: url('images/hero.webp');
      background-size: cover;
      background-position: center;
      color: white;
      display: flex;
      align-items: center;
      position: relative;
      margin-bottom: 2rem;
      overflow: hidden; /* Ensure bounding boxes don't overflow */
    }

    .hero-section::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5); /* Dark overlay for better text visibility */
      z-index: 1;
    }

    .hero-content {
      position: relative;
      z-index: 2; /* Place content above the overlay */
    }

    /* Bounding box styles */
    .bounding-box {
      position: absolute;
      border: 2px solid;
      border-radius: 3px;
      z-index: 2;
      opacity: 0;
      transform-origin: center;
      will-change: opacity, transform;
    }
    .bounding-box.building {
      border-color: rgba(37, 99, 235, 0.8);
      background-color: rgba(37, 99, 235, 0.2);
    }
    .bounding-box.vehicle {
      border-color: rgba(16, 185, 129, 0.8);
      background-color: rgba(16, 185, 129, 0.2);
    }
    .bounding-box.vessel {
      border-color: rgba(139, 92, 246, 0.8);
      background-color: rgba(139, 92, 246, 0.2);
    }
    .bounding-box.container {
      border-color: rgba(239, 68, 68, 0.8);
      background-color: rgba(239, 68, 68, 0.2);
    }

    /* Base fadeInOut animation - actual duration will be set in JavaScript */
    @keyframes fadeInOut {
      0% { opacity: 0; transform: scale(0.95); }
      10% { opacity: 0.8; transform: scale(1); }
      90% { opacity: 0.8; transform: scale(1); }
      100% { opacity: 0; transform: scale(0.95); }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.03); }
      100% { transform: scale(1); }
    }

    .btn-primary {
      background-color: var(--primary);
      border-color: var(--primary);
    }

    .btn-primary:hover {
      background-color: var(--primary-dark);
      border-color: var(--primary-dark);
    }

    .btn-outline-primary {
      color: var(--primary);
      border-color: var(--primary);
    }

    .btn-outline-primary:hover {
      background-color: var(--primary);
      border-color: var(--primary);
    }

    .card {
      border: none;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
                  0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
                  0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .bg-success {
      background-color: #10b981 !important;
    }

    .bg-info {
      background-color: #06b6d4 !important;
    }

    .bg-primary {
      background-color: var(--primary) !important;
    }

    .bg-light {
      background-color: var(--light) !important;
    }

    footer {
      background-color: var(--dark) !important;
    }

    .text-muted {
      color: var(--text-muted) !important;
    }

    #backToTop {
      bottom: 30px;
      right: 30px;
      z-index: 999;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--primary);
      border-color: var(--primary);
    }

    #backToTop:hover {
      background-color: #2563eb;
      border-color: #2563eb;
    }

    /* Make the back to top arrow white */
    #backToTop i {
      color: white;
    }

    .tab-content {
      min-height: 500px;
      padding: 2rem 0;
    }

    @media (max-width: 768px) {
      .hero-section {
        height: 320px;
      }
      /* Reduced text sizes for mobile */
      .hero-section h1 {
        font-size: 2rem !important; /* Smaller than display-4 */
      }
      .hero-section .lead {
        font-size: 1rem !important; /* Smaller lead text */
      }
      .hero-section .btn-lg {
        padding: 0.5rem 1rem;
        font-size: 0.95rem;
      }
    }

    @media (max-width: 576px) {
      .hero-section h1 {
        font-size: 1.75rem !important; /* Even smaller for very small devices */
      }
    }

    /* Animation for back to top button */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 0.5s;
    }

    /* ClustrMaps container */
    .clustrmaps-container {
      margin-top: 15px;
      text-align: center;
      background-color: #1a2234;
      padding: 10px;
      border-radius: 5px;
    }

    /* Category pill styles */
    .category-pill {
      display: inline-block;
      padding: 6px 12px;
      margin: 3px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .info-card {
      margin-bottom: 20px;
    }

    .info-card .card-header {
      background-color: rgba(37, 99, 235, 0.1);
      font-weight: 600;
      color: var(--primary-dark);
      border: none;
    }

    .news-date {
      font-size: 0.9rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .news-list {
      list-style: none;
      padding: 0;
    }

    .news-list li {
      border-bottom: 1px solid #e2e8f0;
      padding: 1.25rem 0;
    }

    .news-list li:last-child {
      border-bottom: none;
    }

    .sample-image {
      width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      margin-bottom: 15px;
    }

    .image-caption {
      font-size: 0.9rem;
      color: var(--text-dark);
      text-align: center;
      margin-bottom: 20px;
    }

    .acknowledgement {
      font-size: 0.85rem;
      color: var(--text-muted);
      font-style: italic;
      margin-top: 1rem;
    }

    .tnc-link {
      text-decoration: underline;
      color: var(--primary);
    }

    .profile-image {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 50%;
    }

    /* PhotoSwipe thumbnails styling */
    .gallery-thumbnail {
      display: block;
      width: 100%;
      height: auto;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.3s ease;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .gallery-thumbnail:hover {
      transform: scale(1.02);
    }

    .gallery-item {
      margin-bottom: 15px;
      position: relative;
    }

    .gallery-caption {
      margin-top: 8px;
      font-size: 0.9rem;
      text-align: center;
    }

    /* Override PhotoSwipe default styles */
    .pswp__img {
      object-fit: contain !important;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
      <a class="navbar-brand" href="#"><i class="fas fa-map-marked-alt me-2"></i> Hong Kong Geospatial Deep Learning Datasets</a>
      <button class="navbar-toggler" type="button" style="padding: 0;" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" id="home-tab" data-bs-target="#home" role="tab" aria-controls="home"
              aria-selected="true">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="dataset-tab" data-bs-target="#dataset" role="tab" aria-controls="dataset"
              aria-selected="false">Dataset</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="people-tab" data-bs-target="#people" role="tab" aria-controls="people"
              aria-selected="false">People</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Hero Section with Floating Bounding Boxes -->
  <div class="hero-section" id="hero-section">
    <div class="container h-100">
      <div class="row h-100 align-items-center">
        <div class="col-12 text-center text-white hero-content">
          <h1 class="display-4 fw-bold">Hong Kong Geospatial Deep Learning Datasets</h1>
          <p class="lead">Discover, explore, and utilize geospatial deep learning data for Hong Kong</p>
          <button class="btn btn-light btn-lg" id="exploreDatasets">Explore Datasets</button>
        </div>
      </div>
    </div>
    <!-- Bounding boxes will be added here by JavaScript -->
  </div>

  <!-- Tab Content -->
  <div class="container mt-5">
    <div class="tab-content">
      <!-- Home Tab -->
      <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
        <div class="row">
          <div class="col-md-8">
            <h2 class="mb-4">Latest News</h2>
            <ul class="news-list">
              <li>
                <h4>Release of Datasets</h4>
                <p class="news-date mb-3">June 7, 2025</p>
                <p>We are pleased to announce the release of the geospatial deep learning datasets for Hong Kong. This release includes annotated data for both object detection and semantic segmentation tasks.</p>
                <p>All datasets are provided in YOLO format for easy integration with Ultralytics YOLO workflow.</p>
                <a href="#" class="btn btn-primary" id="view-datasets-btn">View Datasets</a>
              </li>
            </ul>
          </div>
          <div class="col-md-4">
            <!-- Sample Detection Image with PhotoSwipe gallery -->
            <div class="gallery-item">
              <a href="images/sample-detection.webp" data-pswp-width="1200" data-pswp-height="800" target="_blank"
                class="gallery-link">
                <img src="images/sample-detection-thumb.webp" alt="Object Detection Example"
                  class="gallery-thumbnail" />
              </a>
              <div class="gallery-caption">
                <strong>Object Detection Example:</strong> Identification of buildings, vehicles, and vessels near Victoria Harbour. (Click to enlarge image)
              </div>
            </div>

            <!-- Sample Segmentation Image with PhotoSwipe gallery -->
            <div class="gallery-item">
              <a href="images/sample-segmentation.webp" data-pswp-width="1200" data-pswp-height="800" target="_blank"
                class="gallery-link">
                <img src="images/sample-segmentation-thumb.webp" alt="Semantic Segmentation Example"
                  class="gallery-thumbnail" />
              </a>
              <div class="gallery-caption">
                <strong>Semantic Segmentation Example:</strong> Building and road network segmentation near Kowloon Bay district. (Click to enlarge image)
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Dataset Tab -->
      <div class="tab-pane fade" id="dataset" role="tabpanel" aria-labelledby="dataset-tab">
        <h2 class="mb-4">Description of Datasets</h2>
        <p class="lead">Explore the geospatial deep learning datasets for Hong Kong.</p>
        <!-- Information Cards -->
        <div class="row mb-4">
          <div class="col-12 mb-4">
            <div class="card info-card">
              <div class="card-header">
                <i class="fas fa-image me-2"></i> Image Source and Usage License
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <h5>Image Sources</h5>
                    <ul>
                      <li><strong>Aerial Photography:</strong> Images captured at flying height of about 12,000 feet</li>
                      <li><strong>Resolution:</strong> 0.25m per pixel</li>
                    </ul>
                    <p class="acknowledgement">The orthophotos are provided by the Lands Department of the Government of the Hong Kong Special Administrative Region.</p>
                    <p>For the usage of aerial images, please follow the <a href="https://portal.csdi.gov.hk/csdi-webpage/doc/TNC" target="_blank" class="tnc-link">Terms and Conditions of CSDI Portal</a>.</p>
                  </div>
                  <div class="col-md-6">
                    <h5>Annotation License</h5>
                    <p>The annotations of bounding boxes and segmentation masks are under the MIT License.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12 mb-4">
            <div class="card info-card">
              <div class="card-header">
                <i class="fas fa-tags me-2"></i> Object Detection and Segmentation Categories
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <h5>Object Detection Categories (8 Classes)</h5>
                    <p>The object detection dataset includes annotations for the following features:</p>
                    <div>
                      <span class="category-pill bg-primary text-white">Airplane</span>
                      <span class="category-pill bg-success text-white">Building</span>
                      <span class="category-pill bg-danger text-white">Container lot</span>
                      <span class="category-pill bg-warning text-dark">Facility</span>
                      <span class="category-pill bg-info text-white">Pylon</span>
                      <span class="category-pill bg-secondary text-white">Storage tank</span>
                      <span class="category-pill bg-dark text-white">Vehicle</span>
                      <span class="category-pill" style="background-color: #8B5CF6; color: white;">Vessel</span>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <h5>Segmentation Categories (2 Classes)</h5>
                    <p>The semantic segmentation dataset provides pixel-level annotations for:</p>
                    <div>
                      <span class="category-pill bg-primary text-white">Building</span>
                      <span class="category-pill bg-danger text-white">Road</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12 mb-4">
            <div class="card info-card">
              <div class="card-header">
                <i class="fas fa-code me-2"></i> Annotation Format
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <h5>YOLO Format for Object Detection</h5>
                    <p><strong>Format Structure:</strong></p>
                    <ul>
                      <li>One text file per image</li>
                      <li>Each line represents one bounding box</li>
                      <li>Format: <code>class_id x_center y_center width height</code></li>
                      <li>All values are normalized (0-1) relative to image dimensions</li>
                    </ul>
                    <p><strong>Example:</strong></p>
                    <pre class="bg-light p-2 mt-2" style="font-size: 0.8rem;">
# Example annotation for an image with 3 objects
# Format: class_id x_center y_center width height
2 0.342 0.551 0.123 0.225   # Container lot
7 0.658 0.237 0.042 0.087   # Vessel
6 0.518 0.482 0.025 0.035   # Vehicle
                    </pre>
                  </div>
                  <div class="col-md-6">
                    <h5>YOLO Format for Segmentation</h5>
                    <p><strong>Format Structure:</strong></p>
                    <ul>
                      <li>One text file per image</li>
                      <li>Each line represents one polygon</li>
                      <li>Format: <code>class_id x1 y1 x2 y2 ... xn yn</code></li>
                      <li>All coordinates are normalized (0-1)</li>
                    </ul>
                    <p><strong>Example:</strong></p>
                    <pre class="bg-light p-2 mt-2" style="font-size: 0.8rem;">
# Example segmentation for a building
# Format: class_id x1 y1 x2 y2 ... xn yn
0 0.123 0.456 0.133 0.467 0.153 0.485 0.183 0.492 0.198 0.472 0.173 0.458 0.123 0.456

# Example segmentation for a road
1 0.301 0.617 0.312 0.645 0.354 0.683 0.385 0.674 0.367 0.629 0.328 0.603 0.301 0.617
                    </pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Dataset Cards -->
        <div class="row">
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                  <i class="fas fa-object-group fa-2x text-primary me-3"></i>
                  <h5 class="card-title mb-0">Object Detection Dataset</h5>
                </div>
                <p class="card-text">Large dataset for geospatial object detection in Hong Kong urban environments with 8 different object classes.</p>
                <ul>
                  <li>270,000+ annotated images</li>
                  <li>8 object classes</li>
                </ul>
                <div class="d-flex justify-content-between align-items-center">
                  <span class="badge bg-success">Kaggle</span>
                  <a href="https://www.kaggle.com/datasets/c22003109g/hong-kong-geospatial-object-detection-dataset" target="_blank" class="btn btn-primary">Download Dataset</a>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                  <i class="fas fa-layer-group fa-2x text-secondary me-3"></i>
                  <h5 class="card-title mb-0">Segmentation Dataset</h5>
                </div>
                <p class="card-text">Pixel-level semantic segmentation dataset for Hong Kong focusing on building and road classes.</p>
                <ul>
                  <li>Pixel-wise annotations</li>
                  <li>2 key urban classes</li>
                </ul>
                <div class="d-flex justify-content-between align-items-center">
                  <span class="badge bg-success">Kaggle</span>
                  <a href="https://www.kaggle.com/datasets/c22003109g/hong-kong-geospatial-segmentation-dataset" target="_blank" class="btn btn-primary">Download Dataset</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- People Tab -->
      <div class="tab-pane fade" id="people" role="tabpanel" aria-labelledby="people-tab">
        <h2 class="mb-4">Our Team and Contributors</h2>
        <p class="lead">Please feel free to contact us anytime about the project.</p>
        <div class="row">
          <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 text-center">
              <div class="card-body">
                <img src="images/ameer.webp" alt="Dr. Ameer Hamza Khan" class="profile-image mb-3" />
                <h5 class="card-title">Dr. Ameer Hamza Khan</h5>
                <p class="card-text text-muted">Project Advisor</p>
              </div>
              <div class="card-footer bg-transparent">
                <div class="d-flex justify-content-center">
                  <a href="https://www.linkedin.com/in/ahk/" target="_blank" class="btn btn-outline-dark btn-sm mx-1"><i class="fab fa-linkedin"></i></a>
                  <a href="mailto:ahakhan@polyu.edu.hk" class="btn btn-outline-dark btn-sm mx-1"><i class="fas fa-envelope"></i></a>
                  <a href="https://www.ahkhan.me/" target="_blank" class="btn btn-outline-dark btn-sm mx-1"><i class="fas fa-globe"></i></a>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 text-center">
              <div class="card-body">
                <img src="images/yung.webp" alt="Curtis Yung" class="profile-image mb-3" />
                <h5 class="card-title">Curtis Yung</h5>
                <p class="card-text text-muted">GIS Analyst</p>
              </div>
              <div class="card-footer bg-transparent">
                <div class="d-flex justify-content-center">
                  <a href="mailto:kwok-wun.yung@connect.polyu.hk" class="btn btn-outline-dark btn-sm mx-1"><i class="fas fa-envelope"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="text-white py-4 mt-5">
    <div class="container">
      <div class="row">
        <div class="col-md-5 mb-3 mb-md-0">
          <h5><i class="fas fa-map-marked-alt me-2"></i> HK Geospatial DL Datasets</h5>
          <!-- ClustrMaps Visitor Counter with updated key -->
          <div class="clustrmaps-container">
            <script type="text/javascript" id="clustrmaps" src="//clustrmaps.com/map_v2.js?d=Ttx4k5k__7DyTFHVfApVHGZuaRWudf97Ro07XY6ePy0&cl=ffffff&w=300"></script>
            <p class="text-muted mt-1 mb-0" style="font-size: 0.8rem;">Visitor Statistics</p>
          </div>
        </div>
        <div class="col-md-3 mb-3 mb-md-0">
          <h5>Quick Links</h5>
          <ul class="list-unstyled">
            <li><a href="#" class="text-decoration-none text-muted nav-link-custom" data-tab="home">Home</a></li>
            <li><a href="#" class="text-decoration-none text-muted nav-link-custom" data-tab="dataset">Datasets</a></li>
            <li><a href="#" class="text-decoration-none text-muted nav-link-custom" data-tab="people">People</a></li>
          </ul>
        </div>
        <div class="col-md-4">
          <h5>Contact Us</h5>
          <ul class="list-unstyled text-muted">
            <li><i class="fas fa-envelope me-2"></i> kwok-wun.yung@connect.polyu.hk</li>
            <li><i class="fas fa-map-marker-alt me-2"></i> Room ZN613, 6/F, Block Z, The Hong Kong Polytechnic University, Hung Hom, Kowloon, Hong Kong</li>
          </ul>
          <div class="mt-3">
            <a href="https://github.com/22003109/hkgeodld" target="_blank" class="text-muted me-2"><i class="fab fa-github fa-lg"></i></a>
          </div>
        </div>
      </div>
      <hr class="my-3 bg-secondary" />
      <div class="row">
        <div class="col-md-6 text-center text-md-start">
          <p class="mb-0 text-muted">Power by GitHub Pages & LSGI</p>
        </div>
        <div class="col-md-6 text-center text-md-end">
          <p class="mb-0 text-muted">Last updated: June 25, 2025</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Back to Top Button -->
  <button id="backToTop" class="btn rounded-circle position-fixed bottom-0 end-0 translate-middle d-none">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- PhotoSwipe lightbox container -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="pswp__bg"></div>
    <div class="pswp__scroll-wrap">
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>
      <div class="pswp__ui pswp__ui--hidden">
        <div class="pswp__top-bar">
          <div class="pswp__counter"></div>
          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
          <button class="pswp__button pswp__button--share" title="Share"></button>
          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>
        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>
        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS Bundle with Popper (updated version) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>

  <!-- PhotoSwipe JS with ES Modules -->
  <script type="module">
    // Import PhotoSwipe
    import PhotoSwipeLightbox from 'https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.js';
    import PhotoSwipe from 'https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe.esm.js';

    // Initialize PhotoSwipe
    const lightbox = new PhotoSwipeLightbox({
      gallery: '.gallery-item',
      children: 'a',
      pswpModule: PhotoSwipe,
      wheelToZoom: true,
      initialZoomLevel: 'fit',
      secondaryZoomLevel: 5,
      maxZoomLevel: 10,
      captionSelector: (element) => {
        const captionEl = element.closest('.gallery-item').querySelector('.gallery-caption');
        return captionEl ? captionEl.textContent : '';
      }
    });
    lightbox.init();
  </script>

  <!-- Custom JS -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const backToTopButton = document.getElementById('backToTop');

      // Show/hide back to top button based on scroll position
      window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
          if (backToTopButton.classList.contains('d-none')) {
            backToTopButton.classList.remove('d-none');
            backToTopButton.classList.add('fade-in');
          }
        } else {
          backToTopButton.classList.add('d-none');
          backToTopButton.classList.remove('fade-in');
        }
      });

      // Scroll to top when button is clicked
      backToTopButton.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });

      // Custom tab navigation (without Bootstrap's built-in tab component)
      const showTab = tabId => {
        document.querySelectorAll('.tab-pane').forEach(tab => tab.classList.remove('show', 'active'));
        const selectedTab = document.getElementById(tabId);
        selectedTab.classList.add('show', 'active');

        document.querySelectorAll('.nav-link').forEach(link => {
          link.classList.remove('active');
          link.setAttribute('aria-selected', 'false');
        });
        const activeNavLink = document.getElementById(tabId + '-tab');
        if (activeNavLink) {
          activeNavLink.classList.add('active');
          activeNavLink.setAttribute('aria-selected', 'true');
        }
        window.scrollTo({
          top: document.querySelector('.container.mt-5').offsetTop - 60,
          behavior: 'smooth'
        });
      };

      document.querySelectorAll('.nav-link').forEach(link =>
        link.addEventListener('click', e => {
          e.preventDefault();
          showTab(link.getAttribute('data-bs-target').substring(1));
        })
      );
      document.querySelectorAll('.nav-link-custom').forEach(link =>
        link.addEventListener('click', e => {
          e.preventDefault();
          showTab(link.getAttribute('data-tab'));
        })
      );
      document.getElementById('view-datasets-btn').addEventListener('click', e => {
        e.preventDefault();
        showTab('dataset');
      });
      document.getElementById('exploreDatasets').addEventListener('click', () => showTab('dataset'));

      // Optimized bounding box system
      const initBoundingBoxes = () => {
        const heroSection = document.getElementById('hero-section');
        const heroWidth = heroSection.offsetWidth;
        const heroHeight = heroSection.offsetHeight;
        const exploreButton = document.getElementById('exploreDatasets');
        const buttonRect = exploreButton.getBoundingClientRect();
        const heroRect = heroSection.getBoundingClientRect();

        const buttonSafeZone = {
          left: buttonRect.left - heroRect.left - 20,
          top: buttonRect.top - heroRect.top - 20,
          right: buttonRect.right - heroRect.left + 20,
          bottom: buttonRect.bottom - heroRect.top + 20
        };

        const edgeMargin = 20;
        const boxTypes = [
          { type: 'building', color: 'rgba(37, 99, 235, 0.8)', bgColor: 'rgba(37, 99, 235, 0.2)' },
          { type: 'vehicle', color: 'rgba(16, 185, 129, 0.8)', bgColor: 'rgba(16, 185, 129, 0.2)' },
          { type: 'vessel', color: 'rgba(139, 92, 246, 0.8)', bgColor: 'rgba(139, 92, 246, 0.2)' },
          { type: 'container', color: 'rgba(239, 68, 68, 0.8)', bgColor: 'rgba(239, 68, 68, 0.2)' }
        ];

        // Calculate base sizes just once
        const baseWidth = Math.min(80, heroWidth * 0.1);
        const baseHeight = Math.min(60, heroHeight * 0.08);

        const positions = [];
        const gridCols = 8, gridRows = 5;
        const cellWidth = heroWidth / gridCols, cellHeight = heroHeight / gridRows;
        for (let row = 0; row < gridRows; row++) {
          for (let col = 0; col < gridCols; col++) {
            const cellLeft = col * cellWidth, cellTop = row * cellHeight;
            for (let i = 0; i < 3; i++) {
              const posX = cellLeft + edgeMargin + Math.random() * (cellWidth - 2 * edgeMargin);
              const posY = cellTop + edgeMargin + Math.random() * (cellHeight - 2 * edgeMargin);
              // Updated multipliers
              const widthMultiplier = 0.4 + Math.random();
              const heightMultiplier = 0.7 + Math.random() * 3.5;
              const width = baseWidth * widthMultiplier;
              const height = baseHeight * heightMultiplier;
              if (!(posX + width < buttonSafeZone.left || posX > buttonSafeZone.right ||
                    posY + height < buttonSafeZone.top || posY > buttonSafeZone.bottom) ||
                  posX + width > heroWidth - edgeMargin || posY + height > heroHeight - edgeMargin) {
                continue;
              }
              positions.push({ left: posX, top: posY, width, height, used: false });
            }
          }
        }
        positions.sort(() => Math.random() - 0.5);

        const activeBoxesByType = { building: [], vehicle: [], vessel: [], container: [] };
        const maxVisibleBoxes = 15;
        const boxElements = Array.from({ length: maxVisibleBoxes }, () => {
          const box = document.createElement('div');
          box.className = 'bounding-box';
          box.style.display = 'none';
          heroSection.appendChild(box);
          return { element: box, active: false, type: null, position: null, timeoutId: null, cleanupTimeoutId: null };
        });

        const hasSignificantOverlap = (rect1, rect2) => {
          const xOverlap = Math.max(0, Math.min(rect1.left + rect1.width, rect2.left + rect2.width) - Math.max(rect1.left, rect2.left));
          const yOverlap = Math.max(0, Math.min(rect1.top + rect1.height, rect2.top + rect2.height) - Math.max(rect1.top, rect2.top));
          const intersectionArea = xOverlap * yOverlap;
          if (intersectionArea === 0) return false;
          const unionArea = rect1.width * rect1.height + rect2.width * rect2.height - intersectionArea;
          return intersectionArea / unionArea > 0.5;
        };

        const findSuitablePosition = boxType => {
          const candidates = positions.filter(
            pos => !pos.used &&
              activeBoxesByType[boxType].every(
                existing => !hasSignificantOverlap({ left: pos.left, top: pos.top, width: pos.width, height: pos.height }, existing.position)
              )
          );
          if (candidates.length) {
            const chosen = candidates[Math.floor(Math.random() * candidates.length)];
            chosen.used = true;
            return { ...chosen };
          }
          // Fallback: try generating a new random position
          for (let attempt = 0; attempt < 10; attempt++) {
            const width = baseWidth * (0.8 + Math.random() * 0.5);
            const height = baseHeight * (0.8 + Math.random() * 2);
            const posX = edgeMargin + Math.random() * (heroWidth - width - 2 * edgeMargin);
            const posY = edgeMargin + Math.random() * (heroHeight - height - 2 * edgeMargin);
            if (!(posX + width < buttonSafeZone.left || posX > buttonSafeZone.right ||
                  posY + height < buttonSafeZone.top || posY > buttonSafeZone.bottom)) continue;
            const newRect = { left: posX, top: posY, width, height };
            if (activeBoxesByType[boxType].every(existing => !hasSignificantOverlap(newRect, existing.position))) {
              return newRect;
            }
          }
          return null;
        };

        const releasePosition = position => {
          const index = positions.findIndex(pos => pos.left === position.left && pos.top === position.top);
          if (index > -1) positions[index].used = false;
        };

        const getActiveBoxCount = () => boxElements.filter(box => box.active).length;

        const activateBox = boxType => {
          const boxInfo = boxElements.find(box => !box.active);
          if (!boxInfo) return false;
          const position = findSuitablePosition(boxType);
          if (!position) return false;
          const typeConfig = boxTypes.find(t => t.type === boxType);
          boxInfo.active = true;
          boxInfo.type = boxType;
          boxInfo.position = position;
          activeBoxesByType[boxType].push(boxInfo);
          const box = boxInfo.element;
          box.className = `bounding-box ${boxType}`;
          box.style.left = `${position.left}px`;
          box.style.top = `${position.top}px`;
          box.style.width = `${position.width}px`;
          box.style.height = `${position.height}px`;
          box.style.borderColor = typeConfig.color;
          box.style.backgroundColor = typeConfig.bgColor;

          const displayDuration = Math.floor(Math.random() * 7000) + 3000;
          const fadeInDuration = Math.min(700, displayDuration * 0.15);
          const visibleDuration = displayDuration - fadeInDuration * 2;

          box.style.opacity = '0';
          box.style.transform = 'scale(0.95)';
          box.style.transition = 'opacity 0.7s, transform 0.7s';
          box.style.display = 'block';
          void box.offsetWidth;
          box.style.opacity = '0.8';
          box.style.transform = 'scale(1)';
          if (Math.random() > 0.7) box.style.animation = 'pulse 2s infinite';

          boxInfo.timeoutId = setTimeout(() => {
            box.style.opacity = '0';
            box.style.transform = 'scale(0.95)';
            boxInfo.cleanupTimeoutId = setTimeout(() => {
              const idx = activeBoxesByType[boxInfo.type].indexOf(boxInfo);
              if (idx > -1) activeBoxesByType[boxInfo.type].splice(idx, 1);
              releasePosition(boxInfo.position);
              boxInfo.active = false;
              boxInfo.type = null;
              boxInfo.timeoutId = null;
              box.style.animation = '';
              box.style.display = 'none';
              setTimeout(() => {
                const nextBoxType = Math.random() > 0.3 ? boxType : boxTypes[Math.floor(Math.random() * boxTypes.length)].type;
                activateBox(nextBoxType);
                if (getActiveBoxCount() < maxVisibleBoxes * 0.8 && Math.random() > 0.5) {
                  const randomType = boxTypes[Math.floor(Math.random() * boxTypes.length)].type;
                  activateBox(randomType);
                }
              }, Math.random() * 800 + 200);
            }, 700);
          }, visibleDuration);
          return true;
        };

        const initSystem = () => {
          let delay = 0;
          const initialBoxes = [
            { type: 'building', count: 3 },
            { type: 'vehicle', count: 3 },
            { type: 'vessel', count: 2 },
            { type: 'container', count: 2 }
          ];
          initialBoxes.forEach(group => {
            for (let i = 0; i < group.count; i++) {
              setTimeout(() => activateBox(group.type), delay);
              delay += 400;
            }
          });

          setTimeout(() => {
            const remainingSlots = maxVisibleBoxes - getActiveBoxCount();
            for (let i = 0; i < remainingSlots; i++) {
              setTimeout(() => {
                const randomType = boxTypes[Math.floor(Math.random() * boxTypes.length)].type;
                activateBox(randomType);
              }, i * 500);
            }
          }, delay + 1000);

          setInterval(() => {
            if (getActiveBoxCount() < maxVisibleBoxes * 0.7) {
              const slotsToFill = Math.min(3, maxVisibleBoxes - getActiveBoxCount());
              for (let i = 0; i < slotsToFill; i++) {
                setTimeout(() => {
                  const randomType = boxTypes[Math.floor(Math.random() * boxTypes.length)].type;
                  activateBox(randomType);
                }, i * 300);
              }
            }
          }, 2000);
        };

        initSystem();

        return () => {
          boxElements.forEach(boxInfo => {
            if (boxInfo.timeoutId) clearTimeout(boxInfo.timeoutId);
            if (boxInfo.cleanupTimeoutId) clearTimeout(boxInfo.cleanupTimeoutId);
            boxInfo.element.remove();
          });
        };
      };

      let cleanupBoundingBoxes = initBoundingBoxes();
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        document.querySelectorAll('.bounding-box').forEach(box => box.style.display = 'none');
        resizeTimeout = setTimeout(() => {
          if (cleanupBoundingBoxes) cleanupBoundingBoxes();
          cleanupBoundingBoxes = initBoundingBoxes();
        }, 300);
      });
    });
  </script>
</body>
</html>